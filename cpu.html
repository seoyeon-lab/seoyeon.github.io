<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë² ìŠ¤í‚¨ë¼ë¹ˆìŠ¤31 - CPU ëŒ€ì „</title>
<style>
body {
  margin: 0;
  font-family: 'Pretendard', sans-serif;
  background: linear-gradient(135deg, #fcd0d0, #f8bcbc); /* ì´ˆê¸°: í”Œë ˆì´ì–´ ë°°ê²½ */
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  transition: background 0.5s;
}
.container {
  width: 360px;
  background: white;
  border-radius: 20px;
  padding: 24px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.2);
}
h1 { margin: 0 0 10px; }
.status { margin-bottom: 10px; font-size: 16px; }
.number {
  font-size: 48px;
  margin: 20px 0;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
  transition: transform 0.2s;
}
.number.active {
  transform: scale(1.2);
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: #667eea;
  color: white;
}
.home-btn { background: #bbb; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ¦ BR 31</h1>
  <div class="status" id="status">ë‹¹ì‹  ì°¨ë¡€ì…ë‹ˆë‹¤</div>
  <div class="number" id="number">0</div>
  <button id="endTurnBtn">í„´ ë„˜ê¸°ê¸°</button>
  <button class="home-btn" onclick="location.href='index.html'">ğŸ  í™ˆìœ¼ë¡œ</button>
</div>

<script>
let current = 0;
let clickCount = 0;
let playerTurn = true;
let difficulty = "hard";
const WIN_NUMBERS = [2,6,10,14,18,22,26,30];

const urlParams = new URLSearchParams(window.location.search);
if(urlParams.has("level")) difficulty = urlParams.get("level");

const numberEl = document.getElementById("number");
const statusEl = document.getElementById("status");
const endTurnBtn = document.getElementById("endTurnBtn");

// í”Œë ˆì´ì–´/CPU ë°°ê²½ìƒ‰
function setPlayerBackground(isPlayer){
  if(isPlayer){
    document.body.style.background = "linear-gradient(135deg, #fcd0d0, #f8bcbc)";
  } else {
    document.body.style.background = "linear-gradient(135deg, #a6c1ee, #8db3f7)";
  }
}

// ìˆ«ì ì—…ë°ì´íŠ¸
function updateNumber(){ numberEl.textContent = current; }

// ìŠ¹íŒ¨ ì²´í¬
function checkLose(who){
  if(current >= 31){
    alert(who === "player" ? "ğŸ˜¢ ì¡Œì–´ìš”!" : "ğŸ‰ ì´ê²¼ì–´ìš”!");
    location.href = "index.html";
  }
}

// ìˆ«ì í´ë¦­
numberEl.onclick = () => {
  if(!playerTurn) return;
  if(clickCount >=3) return;

  // ê°•ì¡°: ì‚´ì§ ì»¤ì§€ê¸°
  numberEl.classList.add("active");
  setTimeout(()=>numberEl.classList.remove("active"), 200);

  current++;
  clickCount++;
  updateNumber();
  checkLose("player");

  if(clickCount === 3){
    // 0.6ì´ˆ ë”œë ˆì´ í›„ CPU ì°¨ë¡€
    setTimeout(endPlayerTurn, 600);
  }
};

// í„´ ë„˜ê¸°ê¸° ë²„íŠ¼
endTurnBtn.onclick = () => {
  if(!playerTurn) return;
  if(clickCount === 0) return;
  endPlayerTurn();
};

function endPlayerTurn(){
  playerTurn = false;
  clickCount = 0;
  statusEl.textContent = "ì»´í“¨í„° ì°¨ë¡€ì…ë‹ˆë‹¤";
  setPlayerBackground(false); // CPU ë°°ê²½ ì ìš©
  setTimeout(cpuTurn, 800);
}

// CPU í„´
function cpuTurn(){
  let steps;
  if(difficulty === "easy"){
    steps = Math.floor(Math.random()*3)+1;
  } else if(difficulty === "normal"){
    if(Math.random()<0.5){
      steps = nextWinSteps();
    } else {
      steps = Math.floor(Math.random()*3)+1;
    }
  } else { // hard
    steps = nextWinSteps();
  }

  steps = Math.min(steps, 31-current);
  let i=0;

  const interval = setInterval(()=>{
    current++;
    updateNumber();
    checkLose("cpu");
    i++;
    if(i>=steps){
      clearInterval(interval);
      playerTurn = true;
      statusEl.textContent = "ë‹¹ì‹  ì°¨ë¡€ì…ë‹ˆë‹¤";
      setPlayerBackground(true); // í”Œë ˆì´ì–´ ë°°ê²½ ì ìš©
    }
  }, 600);
}

// ë‹¤ìŒ í•„ìŠ¹ ìˆ«ì ê³„ì‚°
function nextWinSteps(){
  for(let i=0;i<WIN_NUMBERS.length;i++){
    let num = WIN_NUMBERS[i];
    if(num>current && num-current<=3) return num-current;
  }
  return Math.min(3,31-current);
}

// ì´ˆê¸° ë°°ê²½ ì„¤ì •
setPlayerBackground(true);
</script>
</body>
</html>
